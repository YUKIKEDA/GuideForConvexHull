# 第12章 3次元への拡張

Part II では2次元の凸包を扱ってきました。この章からは**3次元凸包**に入ります。2次元の凸包が凸多角形だったのに対し、3次元では**凸多面体**（convex polyhedron）になります。まず、3次元幾何の基礎と、3次元凸包の定義・性質を押さえます。

---

## 12.1 3D 幾何の基礎

### 平面の方程式、法線ベクトル

3次元空间における**平面**は、次の形で表せます。

$$
ax + by + cz + d = 0
$$

$(a, b, c)$ は平面に**垂直**なベクトルで、**法線ベクトル**（normal vector）と呼びます。$d$ は定数項です。

**3点を通る平面**

異なる3点 $A$, $B$, $C$ を通る平面の法線ベクトルは、2つの辺の**外積**で得られます。

$$
\vec{n} = (B - A) \times (C - A)
$$

外積の向きは、$A \to B \to C$ が反時計回り（右手系で「上」から見たとき）だと、$\vec{n}$ はその進行方向の「上」を向きます。法線を正規化する場合は $\vec{n} / |\vec{n}|$ とします。

### 3次元の外積

2次元では外積はスカラーでしたが、3次元では**ベクトル**になります。

$$
\vec{a} \times \vec{b} = (a_y b_z - a_z b_y,\; a_z b_x - a_x b_z,\; a_x b_y - a_y b_x)
$$

- **向き**：$\vec{a}$ と $\vec{b}$ の両方に垂直で、右手系の向き
- **大きさ**：$|\vec{a} \times \vec{b}| = |\vec{a}| |\vec{b}| \sin\theta$（2ベクトルが張る平行四辺形の面積）

### 4点の向き（四面体の符号付き体積）

2次元では「3点の向き」を外積で判定しました。3次元では、**4点 $A$, $B$, $C$, $D$ の向き**が重要になります。

**符号付き体積**

四面体 $ABCD$ の**符号付き体積**は、次の式で与えられます。

$$
\text{volume}(A, B, C, D) = \frac{1}{6} \bigl( (B-A) \times (C-A) \bigr) \cdot (D-A)
$$

スカラー三重積（混合積）を用いると、

$$
\text{volume}(A, B, C, D) = \frac{1}{6} \det\begin{pmatrix} B_x-A_x & B_y-A_y & B_z-A_z \\ C_x-A_x & C_y-A_y & C_z-A_z \\ D_x-A_x & D_y-A_y & D_z-A_z \end{pmatrix}
$$

**符号の意味**

- $\text{volume} > 0$：$D$ は平面 $ABC$ の**法線の正の側**（$A \to B \to C$ が反時計回りのとき、その「上」）
- $\text{volume} < 0$：$D$ は平面 $ABC$ の**負の側**
- $\text{volume} = 0$：$D$ は平面 $ABC$ 上（4点が同一平面上）

これは2次元の「3点の向き」（外積の符号）の3次元版です。凸包アルゴリズムでは、**点が面のどちら側にあるか**の判定に使います。

**実装例**

```python
def cross3d(a, b):
    """3次元ベクトルの外積 a × b"""
    return (
        a[1]*b[2] - a[2]*b[1],
        a[2]*b[0] - a[0]*b[2],
        a[0]*b[1] - a[1]*b[0]
    )

def dot3d(a, b):
    return a[0]*b[0] + a[1]*b[1] + a[2]*b[2]

def signed_volume(a, b, c, d):
    """四面体 ABCD の符号付き体積の6倍（比較のみならこれで十分）"""
    ab = (b[0]-a[0], b[1]-a[1], b[2]-a[2])
    ac = (c[0]-a[0], c[1]-a[1], c[2]-a[2])
    ad = (d[0]-a[0], d[1]-a[1], d[2]-a[2])
    return dot3d(cross3d(ab, ac), ad)

def point_above_plane(a, b, c, d):
    """点 D が平面 ABC の正の側にあるか"""
    return signed_volume(a, b, c, d) > 0
```

---

## 12.2 3次元凸包の定義と性質

### 定義

点集合 $P \subseteq \mathbb{R}^3$ の**凸包**は、$P$ のすべての点を含む最小の凸集合です。2次元と同様の定義がそのまま成り立ちます。

### 凸多面体としての表現

3次元凸包は**凸多面体**であり、次の要素で構成されます。

- **頂点（vertex）**：凸包上にある $P$ の点
- **辺（edge）**：2頂点を結ぶ線分で、凸包の稜線になっているもの
- **面（face）**：3頂点以上で囲まれた凸多角形。通常は**三角形**で近似する（三角メッシュ）

凸多面体の各面は平面の一部であり、すべての頂点はその面の同一側（多くは「外側」）にあります。

### 性質

| 性質 | 説明 |
|------|------|
| **面の一意性** | 各面は平面の一部であり、その平面上に頂点が載る |
| **法線の向き** | 凸多面体の外側を向くように、各面の法線を一貫して定められる |
| **隣接関係** | 各辺はちょうど2つの面に属する。各頂点は複数の辺・面に属する |

---

## 12.3 面・辺・頂点の関係（オイラー標数）

凸多面体の頂点・辺・面の数には、**オイラーの多面体公式**が成り立ちます。

$$
V - E + F = 2
$$

- $V$：頂点数
- $E$：辺数
- $F$：面数

**例**：立方体は $V=8$, $E=12$, $F=6$ で、$8 - 12 + 6 = 2$。

すべての面が三角形である場合（三角メッシュ）には、$2E = 3F$ が成り立つ（各辺は2面に、各面は3辺に属するため）。これとオイラー公式から、$F \approx 2V$、$E \approx 3V$ といった関係が導かれ、頂点数に対して面・辺の数がほぼ線形であることが分かります。

### 実装への示唆

- 凸包の面を**三角形**で表現すると、データ構造が単純になり、後続のアルゴリズム（可視化、メッシュ処理）と相性が良い
- 頂点・辺・面の**隣接関係**を効率的に管理するには、Half-edge や DCEL などのデータ構造が有効（第15章）

---

## 本章のまとめ

- **3次元の平面**は $ax+by+cz+d=0$ で表され、法線ベクトルは $(a,b,c)$ である。
- **4点の向き**は四面体の符号付き体積で判定し、点が面のどちら側にあるかを決める。
- **3次元凸包**は凸多面体であり、頂点・辺・面で構成される。
- **オイラー公式** $V - E + F = 2$ が成り立つ。

次章では、**3次元 Gift Wrapping** を学び、2次元の「巻いていく」アルゴリズムを3次元に拡張します。
