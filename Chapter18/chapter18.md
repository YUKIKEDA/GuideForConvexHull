# 第18章 高次元凸包

これまで主に2次元・3次元の凸包を扱ってきました。この章では、**4次元以上**の凸包への一般化を扱います。高次元では「面」が**超平面**（hyperplane）で表される**ファセット**（facet）となり、計算量やメモリの制約が厳しくなります。

---

## 18.1 4次元以上への一般化

### 定義の拡張

点集合 $P \subseteq \mathbb{R}^d$ の**凸包**は、$P$ のすべての点を含む最小の凸集合です。2次元・3次元と同様の定義がそのまま成り立ちます。

### 凸多面体（ポリトープ）としての表現

$d$ 次元の凸包は**凸多面体**（convex polytope）であり、次の要素で構成されます。

| 次元 | 名称 | 説明 |
|------|------|------|
| 0 | 頂点（vertex） | 凸包上にある $P$ の点 |
| 1 | 辺（edge） | 2頂点を結ぶ線分 |
| 2 | 面（face） | 2次元の面 |
| $\ldots$ | $\ldots$ | $\ldots$ |
| $d-1$ | ファセット（facet） | $d$ 次元空間における $d-1$ 次元の「面」 |
| $d$ | 本体 | 凸多面体全体 |

$d$ 次元では、凸包の境界は**ファセット**（超平面の一部）で構成されます。

### 向きの判定の一般化

2次元では3点の外積、3次元では4点の符号付き体積で「向き」を判定しました。$d$ 次元では、$d+1$ 点が定める**単体**（simplex）と、$d+2$ 番目の点の位置関係で判定します。

$d+1$ 点 $p_1, \ldots, p_{d+1}$ が張る超平面に対し、点 $q$ がどちら側にあるかは、$(d+1) \times (d+1)$ の行列の**行列式**（符号付き体積の一般化）で決まります。

$$
\text{orient}(p_1, \ldots, p_{d+1}, q) = \det\begin{pmatrix} p_1 & 1 \\ \vdots & \vdots \\ p_{d+1} & 1 \\ q & 1 \end{pmatrix}
$$

符号が正・負・ゼロで、$q$ が超平面の正の側・負の側・面上にあるかを判定できます。

---

## 18.2 ファセット（超平面）の扱い

### 超平面の表現

$d$ 次元空間の**超平面**は、次の形で表されます。

$$
a_1 x_1 + a_2 x_2 + \cdots + a_d x_d + a_0 = 0
$$

$(a_1, \ldots, a_d)$ が法線ベクトル（のスカラー倍）であり、超平面に垂直です。点 $p = (p_1, \ldots, p_d)$ が超平面のどちら側にあるかは、$a_1 p_1 + \cdots + a_d p_d + a_0$ の符号で判定します。

### ファセットとは

凸多面体の**ファセット**は、$d-1$ 次元の面であり、1つの超平面上に載っています。各ファセットは、その超平面が凸多面体と交わる部分です。

**ファセットの表現**

- 超平面の係数 $(a_1, \ldots, a_d, a_0)$
- ファセットを構成する頂点の集合（$d$ 個の頂点が超平面を決定する）

### 点がファセットのどちら側にあるかの判定

ファセットの超平面を $H$ とし、法線を凸包の**外側**に向けておきます。点 $p$ について：

- $p$ が $H$ の正の側：$p$ はファセットから「見える」（凸包の外側）
- $p$ が $H$ の負の側：$p$ は凸包の内側
- $p$ が $H$ 上：$p$ はファセット上（境界）

増分構築や Gift Wrapping の高次元版では、この判定が基本になります。

---

## 18.3 双対性（点と超平面の双対）

### 点と超平面の双対

凸包には**双対表現**があります。

**元の表現（V-representation）**：頂点の集合として凸包を表す。「これらの点の凸包」

**双対表現（H-representation）**：半空間の交叉として凸包を表す。「これらの超平面が定める半空間の共通部分」

各ファセットは1つの超平面に対応し、その超平面が定める半空間の「内側」が凸包を含みます。したがって、凸包は**ファセットの超平面が定める半空間の交叉**としても表現できます。

### 双対の変換

- **点 $p = (p_1, \ldots, p_d)$** を超平面 $p_1 x_1 + \cdots + p_d x_d = 1$ に写す（ある種の双対変換）
- 凸包の頂点が、双対空間では超平面に対応し、その交叉が双対凸包になる

この双対性により、凸包のアルゴリズムと**半空間交叉**のアルゴリズムが対応します。また、Delaunay 三角分割と Voronoi 図の双対性（第19章）とも関連しています。

---

## 18.4 計算量と実用上の制約

### ファセット数の上界

$n$ 点の $d$ 次元凸包のファセット数は、**Upper Bound Theorem**（McMullen, 1970）により、最大で

$$
O\left(n^{\lfloor d/2 \rfloor}\right)
$$

となります。$d$ が大きいと、ファセット数が $n$ のべき乗で増加します。

| 次元 $d$ | ファセット数の上界 |
|----------|---------------------|
| 2 | $O(n)$ |
| 3 | $O(n)$ |
| 4 | $O(n^2)$ |
| 5 | $O(n^2)$ |
| 6 | $O(n^3)$ |
| $\ldots$ | $\ldots$ |

### 計算量

- **Gift Wrapping**：$O(n \cdot f)$（$f$ はファセット数）。最悪 $O(n^{1 + \lfloor d/2 \rfloor})$
- **QuickHull・増分構築**：平均的にはより良いことがあるが、高次元では依然として高コスト
- **出力の大きさ**：ファセット数が指数関数的に増えるため、出力自体が巨大になりうる

### 実用上の制約

| 問題 | 説明 | 対策 |
|------|------|------|
| **メモリ** | ファセット数が多く、データ構造が肥大化する | 次元を絞る、サンプリング |
| **計算時間** | 計算量が急増する | 近似アルゴリズム、並列化 |
| **可視化** | 4次元以上は直接可視化できない | 射影、次元削減 |
| **数値誤差** | 高次元では判定の誤差が蓄積しやすい | 高精度演算、摂動 |

### Qhull での高次元凸包

Qhull は任意の次元 $d$ に対応しています。ただし、$d$ が 8〜10 を超えると、点数やファセット数によってはメモリ不足や計算時間の爆発が起きやすくなります。`rbox c D7 | qconvex` のように、次元を指定して実行できます。

---

## 本章のまとめ

- **高次元凸包**は凸多面体であり、境界は**ファセット**（超平面の一部）で構成される
- **向きの判定**は $(d+1) \times (d+1)$ の行列式で行う
- **双対性**により、頂点表現と半空間交叉表現が対応する
- **計算量とファセット数**は $O(n^{\lfloor d/2 \rfloor})$ 程度まで増え得るため、高次元では実用上の制約が厳しい

次章では、**Delaunay 三角分割**と**Voronoi 図**を扱い、凸包との関係を学びます。
