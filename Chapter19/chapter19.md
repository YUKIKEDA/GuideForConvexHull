# 第19章 関連する幾何構造

凸包は、**Delaunay 三角分割**や**Voronoi 図**と密接に関連しています。これらは計算幾何の基本であり、凸包のアルゴリズムがそのまま応用されることもあります。この章では、各構造の定義と相互の関係、応用を扱います。

---

## 19.1 Delaunay 三角分割

### 定義

点集合 $P$ が与えられたとき、$P$ の点を頂点とする**三角分割**は、平面を互いに重ならない三角形で分割し、すべての三角形の頂点が $P$ に含まれるものです。

**Delaunay 三角分割**（Delaunay triangulation）は、次の条件を満たす三角分割です。

**空円条件（Empty Circle Property）**：任意の三角形の**外接円**の内部に、その三角形の頂点以外の点が存在しない。

言い換えると、各三角形は「できるだけ潰れていない」形になり、鋭角が多く、長細い三角形が避けられます。

### 凸包との関係

**持ち上げ変換（Lifting）**

2次元の点 $p = (x, y)$ を、3次元の抛物面 $z = x^2 + y^2$ 上の点 $(x, y, x^2 + y^2)$ に写します。このとき、**2次元の Delaunay 三角分割**は、**持ち上げられた点の3次元凸包**の下側の面を平面に射影したものと一致します。

```
2次元の点  →  放物面上の点  →  凸包（下側）  →  射影して Delaunay
```

したがって、3次元凸包のアルゴリズム（Qhull など）を使って Delaunay 三角分割を計算できます。Qhull の `qdelaunay` はこの原理を利用しています。

### 一意性

一般の位置にある点（4点が同一円周上にない）では、Delaunay 三角分割は一意です。退化している場合は、複数の Delaunay 三角分割が存在し得ます。

---

## 19.2 Voronoi 図

### 定義

点集合 $P = \{p_1, \ldots, p_n\}$ に対し、**Voronoi 図**（Voronoi diagram）は、平面を次のように分割したものです。

各点 $p_i$ に対して、**Voronoi 領域** $V(p_i)$ を
$$
V(p_i) = \{ q \in \mathbb{R}^2 : d(q, p_i) \leq d(q, p_j) \text{ for all } j \neq i \}
$$
で定義します。つまり、$p_i$ に最も近い点の集合です。

Voronoi 図は、すべての $V(p_i)$ から成り、その境界が **Voronoi 辺**、辺の交点が **Voronoi 頂点**です。

### Delaunay との双対性

**Delaunay 三角分割**と**Voronoi 図**は**双対**の関係にあります。

| Delaunay | Voronoi |
|----------|---------|
| 三角形 | Voronoi 頂点（外接円の中心） |
| 辺 | Voronoi 辺（垂直二等分線の一部） |
| 頂点 | Voronoi 領域 |

- Delaunay の各三角形の**外接円の中心**が、Voronoi の頂点になる
- Delaunay の辺の**垂直二等分線**が、Voronoi の辺になる
- 凸包の頂点に対応する Voronoi 領域は**非有界**（外側に無限に広がる）

したがって、Delaunay 三角分割が求まれば Voronoi 図も構成でき、その逆も可能です。

---

## 19.3 凸包 ↔ Delaunay ↔ Voronoi の関係図

### 3者の関係

```
        放物面への持ち上げ
凸包（3次元、下側） ←―――――― 2次元の点
        |
        | 射影
        ↓
   Delaunay 三角分割
        |
        | 双対
        ↓
    Voronoi 図
```

### 凸包と Voronoi の対応

- **凸包の頂点**：対応する Voronoi 領域が**非有界**
- **凸包の辺**：2つの凸包頂点を結び、対応する2つの Voronoi 領域が無限遠で隣接
- **凸包の内部の点**：対応する Voronoi 領域は**有界**

凸包の頂点は、他のどの点よりも「外側」にあるため、その Voronoi 領域は外側に無限に広がります。

### 計算の流れ

1. **点 → Delaunay**：放物面への持ち上げ + 3次元凸包（Qhull の qdelaunay）
2. **Delaunay → Voronoi**：外接円の中心を Voronoi 頂点とし、垂直二等分線で Voronoi 辺を構成
3. **Voronoi → Delaunay**：Voronoi の双対として Delaunay を復元
4. **点 → 凸包**：直接凸包アルゴリズム（qconvex）

---

## 19.4 応用：メッシュ生成、補間

### メッシュ生成

**Delaunay リファインメント**：与えられた領域を三角形メッシュで分割する際、Delaunay 三角分割を基にすると、三角形の形状が良くなりやすいです。有限要素法（FEM）では、ひし形に近い三角形が望ましいため、Delaunay がよく使われます。

**Constrained Delaunay**：境界や内部の線分を保持しつつ、Delaunay 的な性質を満たす三角分割。地形のメッシュや幾何的な制約付きメッシュに利用されます。

### 補間

**自然近傍補間（Natural Neighbor Interpolation）**：Voronoi 図を用いた補間です。補間したい点がどの Voronoi 領域に含まれるか（またはどの領域の「自然近傍」か）に基づいて、近傍点の重み付き平均で値を推定します。

**シェパード補間**：Voronoi の面積比などを重みに使う補間法もあります。

### その他の応用

- **最近傍探索**：Voronoi 図により、与えられた点に最も近いデータ点を効率的に検索
- **パワー図**：点に重みを持たせた一般化 Voronoi 図
- **媒質のシミュレーション**：Voronoi をセル状の構造として利用

---

## 本章のまとめ

- **Delaunay 三角分割**は空円条件を満たす三角分割であり、抛物面への持ち上げの凸包の射影として得られる
- **Voronoi 図**は各点に最も近い領域の分割であり、Delaunay と双対である
- **凸包**の頂点は、非有界な Voronoi 領域に対応する
- **応用**として、メッシュ生成や補間で Delaunay・Voronoi が広く使われる

次章では、**スクラッチ実装プロジェクト**として、これまで学んだ内容を総合した実装の指針を扱います。
